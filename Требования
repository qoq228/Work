Зачем?

Необходимо предоставить стандартный и удобный интерфейс для провайдеров, чтобы они могли самостоятельно интегрироваться с модулем коммуникаций SberCRM. Это позволит:

Сократить время и затраты на настройку новых интеграций
Обеспечить масштабируемость системы за счет унифицированного подхода к подключению провайдеров
Упростить сопровождение и развитие модуля коммуникаций т.к. все интеграции будут работать через единый интерфейс
Повысить удобство работы пользователей, предоставив им доступ к коммуникациям с клиентами через разные каналы в одном интерфейсе




Кейсы применения
Интеграция новых провайдеров коммуникаций: через предоставленный публичный API провайдеры смогут самостоятельно настраивать интеграцию с модулем коммуникаций SberCRM

Обеспечение непрерывности бизнес-коммуникаций: благодаря унифицированному API компании смогут использовать несколько каналов связи одновременно, обеспечивая отказоустойчивость коммуникаций с клиентами

Базовые требования
Я, как разработчик провайдера, хочу иметь единый API для взаимодействия моей системы с модулем коммуникаций SberCRM
Я. как разработчик провайдера, хочу иметь возможность загружать конфигурацию своего API в модуль коммуникаций для настройки двусторонней передачи информации между сервисами
Я, как разработчик провайдера, хочу иметь доступ к документации о публичном API модуля коммуникаций SberCRM
Я, как разработчик провайдера, хочу иметь возможность протестировать интеграцию на тестовом стенде
Я, как администратор SberCRM, хочу иметь возможность протестировать интеграцию на тестовом стенде до ее ввода в промышленную эксплуатацию
Я, как администратор SberCRM, хочу иметь возможность согласовывать интеграции модуля коммуникаций с системой провайдера до их ввода в промышленную эксплуатацию
Я, как пользователь, хочу пользоваться последней версией API после установки приложения провайдера в SberCRM
Дополнительные требования
Опубликовать документацию публичного API для провайдеров на портале разработчика
Добавить в публичный API поддержку следующего функционала:
Форматирование текста сообщения
Редактирование чатов
Групповые чаты
Передача больших объемов информации (Bulk API)
Требования к провайдерам

Провайдеры для интеграции с публичным API модуля коммуникаций SberCRM  должны соответствовать следующим требованиям:

На стороне провайдера обязательно должны быть следующие методы:
Запрос списка каналов
Одноканальные провайдеры (Авито и тд) должны возвращать пустой список активных каналов
Отправка сообщения
Прочтение сообщений в чате
Обновление статуса сообщения
Отключение приложения в маркетплейсе SberCRM
Со стороны модуля коммуникаций происходит деактивация токена. Провайдер должен перестать направлять в модуль коммуникаций запросы для этого клиента
На стороне провайдера опционально могут быть следующие методы: 
Загрузка истории сообщений
Пакетная отправка сообщений
Установка вебхука
Отключение вебхука
API методы провайдера должны поддерживать формат данных, заданный модулем коммуникаций SberCRM
При регистрации провайдера в модуле коммуникаций, он должен передать список эндпоинтов своего API
При регистрации провайдера в модуле коммуникаций должно использоваться системное имя провайдера, заданное в параметрах его приложения в маркетплейсе
Провайдер должен предоставить тестовый стенд и учетки для проверки интеграции со стороны модераторов SberCRM перед публикацией приложения в маркетплейсе
Файлы должны храниться на серверах провайдера и быть доступны по прямой ссылке
Провайдер должен иметь возможность предоставить клиенту токен авторизации для подключения клиента в приложении провайдера в SberCRM
Допущения, ограничения и другие нефункциональные требования
Допущения
Провайдер должен самостоятельно производить маппинг на модель данных модуля коммуникаций на своей стороне
Провайдер должен гарантировать высокую доступность и корректность своих эндпоинтов
Ограничения
Система не предусматривает автоматическую проверку работоспособности интеграции, настроенной провайдером
Чаты не создаются отдельным методом - вся информация о чате и его участниках должна передаваться внутри каждого сообщения
Нефункциональные требования
Производительность
Система должна выдерживать одновременную переписку в кабинете Коммуникаций 25 500 пользователями
Система должна обеспечивать передачу до 800 сообщений в секунду без снижения производительности
Система должна выдерживать требования к производительности модуля коммуникаций относительно передачи файлов, описанные здесь
Безопасность
Методы регистрации и обновления конфигурации провайдера должны быть доступны только провайдеру по токену разработчика
Другие методы публичного API должны использоваться только с токеном клиента 
Все соединения должны производиться с использованием шифрования mTLS
Масштабируемость
Система без значительного снижения производительности должна:
 Поддерживать рост нагрузки до 45 900 одновременных пользователей
Поддерживать рост нагрузки до 1400 сообщений в секунду
Поддерживать рост нагрузки до 250 операций с файлами в час
Поддерживать рост максимального размера передаваемых файлов до 2 Гб
Система должна использовать механизм очередей сообщений для асинхронной обработки нагрузки
Надежность
Система должна обеспечивать уровень доступности публичного API не ниже 99.95% (4.5 часов простоя в год)
Автоматический ретрай: повторение запроса через 5 секунд при отсутствии ответа от провайдера, до 3 попыток
В случае ошибки использования какого-либо метода система должна уведомить пользователя и зафиксировать ошибку в логах
Сопровождение
Система должна предоставлять тестовый стенд для тестирования интеграции провайдером
Система должна логировать все ошибки обращений к публичному API, срок хранения - не менее 30 дней
Отказоустойчивость
В случае недоступности провайдера/канала система должна ставить все отправляемые данные в очередь и отправить их при восстановлении соединения
Если в течение часа информация не была отправлена - система должна убрать эту запись из очереди и пометить как не отправленную
Удобство
Система должна предоставлять удобную и понятную документацию публичного API на портале разработчика SberCRM
Документация публичного API должна поддерживать локализацию SberCRM
Система должна уведомлять провайдеров об обновлениях, чтобы провайдеры могли своевременно обновить интеграцию
Дополнительная информация
Reference
API чатов в AmoCRM
API чатов в Битрикс24
API чатов в RetailCRM
Salesforce messaging API
